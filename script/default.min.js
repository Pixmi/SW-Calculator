function formatNumber(){let e=Array.from(arguments).toString(),a=e.split("."),t=a[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,", "),l=a[1]>0?`. ${a[1]}`:"";return`${t}${l}`}const addPanel=document.querySelector("#add-panel");addPanel.addEventListener("click",()=>{let e=document.querySelectorAll(".group-panel"),a=e.length,t=document.createElement("div");t.classList.add("group-panel","col-12","col-sm-6","col-md-4","col-lg-3"),t.dataset.index=a,t.innerHTML=`\n        <div class="card mb-3">\n            <div class="card-header">Group ${a+1}.</div>\n            <div class="card-body">\n                <div class="mb-2">\n                    <label>攻擊力</label>\n                    <input type="number" class="form-control form-control-sm" data-input="aDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊率</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cRate" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊傷害</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>貫穿 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="pRate" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>BOSS傷害 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="bDamage" value="" />\n                </div>\n                <div class="formula d-none"></div>\n                <div>輸出：<span class="damage"></span></div>\n            </div>\n        </div>`,e[a-1].after(t)}),document.querySelector("#submit").addEventListener("click",()=>{let e=Number(document.querySelector('[data-input="bDefense"]').value)||0,a=Number(document.querySelector('[data-input="bLevels"]').value)||0,t=Number(document.querySelector('[data-input="bAntiRate"]').value)/100||0,l=document.querySelectorAll(".group-panel");if(l.forEach(l=>{let n=Number(l.querySelector('[data-input="aDamage"]').value)||1,r=(Number(l.querySelector('[data-input="cRate"]').value)+20)/100||1;r=r-t>1?1:r-t;let o=Number(l.querySelector('[data-input="cDamage"]').value)||1,u=Number(l.querySelector('[data-input="bDamage"]').value)/100||0,d=Number(l.querySelector('[data-input="pRate"]').value)/100||0;d=d>1?1:d;let c=l.querySelector(".formula"),m=l.querySelector(".damage"),s=`(${n} * (1 - ${r}) + (${n} + ${o}) * ${r}) * (1 + ${u}) * (1 - ${e} * (1 - ${d}) / (${e} * (1 - ${d}) + 50 * ${a}))`,i=(n*(1-r)+(n+o)*r)*(1+u)*(1-e*(1-d)/(e*(1-d)+50*a));c.textContent=s,m.dataset.value=i.toFixed(3),m.textContent=`${formatNumber(i.toFixed(3))}`}),l.length>1){let e=document.querySelector(".group-compare");for(;e.firstChild;)e.removeChild(e.firstChild);groupDamage=document.querySelectorAll(".damage"),groupDamage.forEach((a,t)=>{if(t>0){let l=groupDamage[0].dataset.value,n=a.dataset.value,r=(100*(n/l-1)).toFixed(2),o=document.createElement("p");o.innerHTML=r>0?`<span class="text-primary">Group ${t+1}</span> 比 <span class="text-danger">Group 1</span> 增加 ${r}% 傷害。`:`<span class="text-primary">Group ${t+1}</span> 比 <span class="text-danger">Group 1</span> 減少 ${r.replace("-","")}% 傷害。`,e.append(o)}})}});