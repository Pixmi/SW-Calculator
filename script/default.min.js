function formatNumber(){let e=Array.from(arguments).toString(),a=e.split("."),t=a[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,", "),l=a[1]>0?`. ${a[1]}`:"";return`${t}${l}`}const addPanel=document.querySelector("#add-panel");addPanel.addEventListener("click",()=>{let e=document.querySelectorAll(".group-panel"),a=e.length,t=document.createElement("div");t.classList.add("group-panel","col-12","col-sm-6","col-md-4","col-lg-3"),t.dataset.index=a,t.innerHTML=`\n        <div class="card mb-3">\n            <div class="card-header"><input type="text" class="group-title border-bottom" value="Group ${a+1}"></div>\n            <div class="card-body">\n                <div class="mb-2">\n                    <label>攻擊力</label>\n                    <input type="number" class="form-control form-control-sm" data-input="aDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊率 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cRate" value="" placeholder="不含隱藏爆率" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊傷害</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>貫穿 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="pRate" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>BOSS傷害 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="bDamage" value="" />\n                </div>\n                <div class="formula d-none"></div>\n                <div>輸出：<span class="damage"></span></div>\n            </div>\n        </div>`,e[a-1].after(t)}),document.querySelector("#submit").addEventListener("click",()=>{let e=Number(document.querySelector('[data-input="bDefense"]').value)||0,a=Number(document.querySelector('[data-input="bLevels"]').value)||0,t=Number(document.querySelector('[data-input="bAntiRate"]').value)/100||0,l=document.querySelectorAll(".group-panel");if(l.forEach(l=>{let r=Number(l.querySelector('[data-input="aDamage"]').value)||1,n=(Number(l.querySelector('[data-input="cRate"]').value)+20)/100||1;n=n-t>1?1:n-t;let o=Number(l.querySelector('[data-input="cDamage"]').value)||1,u=Number(l.querySelector('[data-input="bDamage"]').value)/100||0,d=Number(l.querySelector('[data-input="pRate"]').value)/100||0;d=d>1?1:d;let c=l.querySelector(".formula"),s=l.querySelector(".damage"),m=`(${r} * (1 - ${n}) + (${r} + ${o}) * ${n}) * (1 + ${u}) * (1 - ${e} * (1 - ${d}) / (${e} * (1 - ${d}) + 50 * ${a}))`,i=(r*(1-n)+(r+o)*n)*(1+u)*(1-e*(1-d)/(e*(1-d)+50*a));c.textContent=m,s.dataset.value=i.toFixed(3),s.textContent=`${formatNumber(i.toFixed(3))}`}),l.length>1){let e=document.querySelector(".group-compare");for(;e.firstChild;)e.removeChild(e.firstChild);let a=Number(l[0].querySelector("span.damage").dataset.value),t=[];l.forEach((r,n)=>{if(t[n]=l[n].querySelector(".group-title").value,n>0){let l=Number(r.querySelector("span.damage").dataset.value),o=(100*(l/a-1)).toFixed(2),u=document.createElement("p");u.innerHTML=o>0?`<span class="text-primary">${t[n]}</span> 比 <span class="text-danger">${t[0]}</span> 增加 ${o}% 傷害。`:`<span class="text-primary">${t[n]}</span> 比 <span class="text-danger">${t[0]}</span> 減少 ${o.replace("-","")}% 傷害。`,e.append(u)}})}});