function formatNumber(){let e=Array.from(arguments).toString(),a=e.split("."),t=a[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,", "),l=a[1]>0?`. ${a[1]}`:"";return`${t}${l}`}const addPanel=document.querySelector("#add-panel");addPanel.addEventListener("click",()=>{let e=document.querySelectorAll(".group-panel"),a=e.length,t=document.createElement("div");t.classList.add("group-panel","col-12","col-sm-6","col-md-4","col-lg-3"),t.dataset.index=a,t.innerHTML=`\n        <div class="card mb-3">\n            <div class="card-header">\n                <div class="row">\n                    <div class="col">\n                        <input type="text" class="group-title border-bottom" value="Group ${a+1}">\n                    </div>\n                    <div class="col-auto pl-0">\n                        <button type="button" class="close" data-click="removeNode"><span aria-hidden="true" data-click="removeNode">&times;</span></button>\n                    </div>\n                </div>\n            </div>\n            <div class="card-body">\n                <div class="mb-2">\n                    <label>攻擊力</label>\n                    <input type="number" class="form-control form-control-sm" data-input="aDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊率 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cRate" value="" placeholder="不含隱藏爆率" />\n                </div>\n                <div class="mb-2">\n                    <label>爆擊傷害</label>\n                    <input type="number" class="form-control form-control-sm" data-input="cDamage" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>貫穿 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="pRate" value="" />\n                </div>\n                <div class="mb-2">\n                    <label>BOSS傷害 %</label>\n                    <input type="number" class="form-control form-control-sm" data-input="bDamage" value="" />\n                </div>\n                <div class="formula d-none"></div>\n                <div>輸出：<span class="damage"></span></div>\n            </div>\n        </div>`,e[a-1].after(t)}),document.querySelector("main").addEventListener("click",e=>{let a=e.target,t="click"in a.dataset&&a.dataset.click;if(t)switch(t){case"removeNode":let e=a.closest(".group-panel");e.remove(),document.querySelectorAll(".group-panel").forEach((e,a)=>{e.dataset.index=a})}}),document.querySelector("#submit").addEventListener("click",()=>{let e=Number(document.querySelector('[data-input="bDefense"]').value)||0,a=Number(document.querySelector('[data-input="bLevels"]').value)||0,t=Number(document.querySelector('[data-input="bAntiRate"]').value)/100||0,l=document.querySelectorAll(".group-panel");if(l.forEach(l=>{let n=Number(l.querySelector('[data-input="aDamage"]').value)||1,r=Number(l.querySelector('[data-input="cRate"]').value)/100||0;r=r-t>1?1:r-t;let o=Number(l.querySelector('[data-input="cDamage"]').value)||1,c=Number(l.querySelector('[data-input="bDamage"]').value)/100||0,d=Number(l.querySelector('[data-input="pRate"]').value)/100||0;d=d>1?1:d;let u=l.querySelector(".formula"),s=l.querySelector(".damage"),i=`(${n} * (1 - ${r}) + (${n} + ${o}) * ${r}) * (1 + ${c}) * (1 - ${e} * (1 - ${d}) / (${e} * (1 - ${d}) + 50 * ${a}))`,m=(n*(1-r)+(n+o)*r)*(1+c)*(1-e*(1-d)/(e*(1-d)+50*a));u.textContent=i,s.dataset.value=m.toFixed(3),s.textContent=`${formatNumber(m.toFixed(3))}`}),l.length>1){let e=document.querySelector(".group-compare");for(;e.firstChild;)e.removeChild(e.firstChild);let a=Number(l[0].querySelector("span.damage").dataset.value),t=[];l.forEach((n,r)=>{if(t[r]=l[r].querySelector(".group-title").value,r>0){let l=Number(n.querySelector("span.damage").dataset.value),o=(100*(l/a-1)).toFixed(2),c=document.createElement("p");c.innerHTML=o>0?`<span class="text-primary">${t[r]}</span> 比 <span class="text-danger">${t[0]}</span> 增加 ${o}% 傷害。`:`<span class="text-primary">${t[r]}</span> 比 <span class="text-danger">${t[0]}</span> 減少 ${o.replace("-","")}% 傷害。`,e.append(c)}})}});